<!-- index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>迷いの森</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="frame">
    <header>
      <div class="score"><span>0</span> ポイント</div>
      <div class="title">迷いの森</div>
      <div class="timer">残り<span>60</span>秒</div>
    </header>

    <div class="lead">
      お宝がたくさんあるらしい<br>
      だが、帰って来ることも考えよう！
    </div>

    <img class="scene" src="./images/start.jpg" alt="迷いの森の入口">

    <div class="row">
      <a class="btn" href="./game.html">入る！</a>
    </div>

    <!-- 👑 ランキングを開くボタン -->
    <button id="ranking-toggle" class="ranking-toggle" type="button" aria-expanded="false">
      <span class="icon">👑</span><span>ランキングを見る</span>
    </button>

    <!-- ▼ ランキング表示エリア ▼ -->
    <div class="ranking" id="ranking-panel">
      <h2>ランキング</h2>
      <ol id="ranking-list"></ol>
    </div>
    <!-- ▲ ランキング表示エリア ▲ -->
  </main>

  <!-- Firebase & ランキング読込（モジュール） -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      get
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBbdkGsWniVFjBj9iAa3KzP1psUDSb4rho",
      authDomain: "shintarogame-c7f21.firebaseapp.com",
      databaseURL:"https://shintarogame-c7f21-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "shintarogame-c7f21",
      storageBucket: "shintarogame-c7f21.appspot.com",
      messagingSenderId: "459244112734",
      appId: "1:459244112734:web:e3f6ee815b3e34950dddcf",
      measurementId: "G-19MHW7VT6K"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // ランキング読み込み
    async function loadRanking() {
      const snapshot = await get(ref(db, "ranking"));
      const list = [];
      snap.forEach(child => list.push(child.val()));

      // score 降順, 同点は time 昇順
      list.sort((a,b) => {
        if (b.score !== a.score) return b.score - a.score;
        return a.time - b.time;
      });

      return list.slice(0, 10);
    }

    const panel = document.getElementById("ranking-panel");
    const ol    = document.getElementById("ranking-list");
    const toggleBtn = document.getElementById("ranking-toggle");

    // ボタンで開閉
    toggleBtn.addEventListener("click", () => {
      const isOpen = panel.classList.toggle("open");
      toggleBtn.setAttribute("aria-expanded", isOpen ? "true" : "false");
    });

    // データを読み込んでリスト表示
    loadRanking()
      .then(rank => {
        if (!ol) return;

        if (rank.length === 0) {
          ol.innerHTML = "<li>まだ記録がありません</li>";
          return;
        }

        rank.forEach((r, i) => {
          const li = document.createElement("li");
          li.textContent = `${i + 1}位： ${r.name} … ${r.score} pt`;
          ol.appendChild(li);
        });
      })
      .catch(err => {
        console.error("ランキングの取得に失敗:", err);
        if (ol) {
          ol.innerHTML = "<li>ランキングの読み込みに失敗しました</li>";
        }
      });
  </script>
</body>
</html>
